<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8">
<title>–ü–æ–º–æ—â–Ω–∏–∫: –†—É—Å—Å–∫–∏–π ‚Üí –ò–≤—Ä–∏—Ç / –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body {
  padding: 25px;
  background: #f8f9fa;
}
textarea {
  resize: vertical;
  min-height: 150px;
  font-size: 18px;
}
#result {
  white-space: pre-wrap;
  min-height: 150px;
  font-size: 18px;
  background: white;
}
.card {
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
}
button {
  font-size: 18px !important;
}
#copyAlert {
  display: none;
}
.spinner {
  display: none;
}
</style>
</head>
<body>

<div class="container">

  <div class="card p-4 mb-4">
    <h2 class="mb-3 text-center">–ü–æ–º–æ—â–Ω–∏–∫: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–≤–æ–¥</h2>

    <!-- –†–ï–ñ–ò–ú -->
    <div class="mb-3">
      <label class="form-label fw-bold">–†–µ–∂–∏–º:</label>
      <select id="mode" class="form-select">
        <option value="fix">–ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ –∏–≤—Ä–∏—Ç–µ</option>
        <option value="translate">–†—É—Å—Å–∫–∏–π ‚Üí –ò–≤—Ä–∏—Ç</option>
        <option value="voice">–ì–æ–ª–æ—Å ‚Üí –ò–≤—Ä–∏—Ç</option>
      </select>
    </div>

    <!-- –í–´–ë–û–† –Ø–ó–´–ö–ê –î–õ–Ø –ì–û–õ–û–°–ê -->
    <div class="mb-3">
      <label class="form-label fw-bold">–Ø–∑—ã–∫ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞:</label>
      <select id="voiceLang" class="form-select">
        <option value="auto">–ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</option>
        <option value="ru-RU">–†—É—Å—Å–∫–∏–π</option>
        <option value="he-IL">–ò–≤—Ä–∏—Ç</option>
      </select>
    </div>

    <!-- –¢–ï–ö–°–¢–û–í–´–ô –í–í–û–î -->
    <div class="mb-3">
      <textarea id="inputText" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç..."></textarea>
    </div>

    <!-- –ö–ù–û–ü–ö–ò -->
    <div class="d-flex gap-2 mb-3">
      <button class="btn btn-primary flex-fill" onclick="processText()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      <button class="btn btn-secondary flex-fill" onclick="startVoice()">üé§ –ì–æ–ª–æ—Å</button>
    </div>

    <!-- –°–ü–ò–ù–ù–ï–† -->
    <div class="text-center spinner" id="loader">
      <div class="spinner-border text-primary" role="status"></div>
      <p>–û–±—Ä–∞–±–æ—Ç–∫–∞...</p>
    </div>

    <!-- –†–ï–ó–£–õ–¨–¢–ê–¢ -->
    <h4 class="mt-3">–†–µ–∑—É–ª—å—Ç–∞—Ç:</h4>
    <div id="result" class="form-control mb-3"></div>

    <!-- –ö–û–ü–ò–†–û–í–ê–ù–ò–ï -->
    <button class="btn btn-success" onclick="copyResult()">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
    <div id="copyAlert" class="text-success mt-2 fw-bold">‚úî –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!</div>

  </div>

</div>


<!-- JS -->
<script>
// ------------------------------
// 1. LanguageTool ‚Äî –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≤—Ä–∏—Ç–∞
// ------------------------------
async function fixHebrew(text) {
  const response = await fetch("https://api.languagetool.org/v2/check", {
    method: "POST",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: "text=" + encodeURIComponent(text) + "&language=he"
  });

  const data = await response.json();
  let corrected = text;

  data.matches.reverse().forEach(match => {
    if (match.replacements && match.replacements.length>0) {
      corrected =
        corrected.slice(0, match.offset) +
        match.replacements[0].value +
        corrected.slice(match.offset + match.length);
    }
  });

  return corrected;
}


// ------------------------------
// 2. LibreTranslate ‚Äî –ø–µ—Ä–µ–≤–æ–¥ RU ‚Üí HE
// ------------------------------
async function translateRuHe(text) {
  const response = await fetch("https://libretranslate.de/translate", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      q: text,
      source: "ru",
      target: "he",
      format: "text"
    })
  });

  const data = await response.json();
  return data.translatedText;
}


// ------------------------------
// 3. –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥ (RU/HE + –∞–≤—Ç–æ)
// ------------------------------
function detectLanguage(text) {
  // –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–∞—è —ç–≤—Ä–∏—Å—Ç–∏–∫–∞
  const hebrew = /[\u0590-\u05FF]/;
  if (hebrew.test(text)) return "he-IL";
  return "ru-RU";
}

function startVoice() {
  if (!("webkitSpeechRecognition" in window) && !("SpeechRecognition" in window)) {
    alert("–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥.");
    return;
  }

  const recognition =
    new (window.SpeechRecognition || window.webkitSpeechRecognition)();

  // –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
  const selected = document.getElementById("voiceLang").value;
  recognition.lang = selected === "auto" ? "ru-RU" : selected;

  recognition.start();

  recognition.onresult = event => {
    let text = event.results[0][0].transcript;

    if (selected === "auto") {
      recognition.lang = detectLanguage(text);
    }

    document.getElementById("inputText").value = text;
  };
}


// ------------------------------
// 4. –û—Å–Ω–æ–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
// ------------------------------
async function processText() {
  const mode = document.getElementById("mode").value;
  const input = document.getElementById("inputText").value.trim();
  const resultBox = document.getElementById("result");
  const loader = document.getElementById("loader");

  if (!input && mode !== "voice") {
    resultBox.innerText = "–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç.";
    return;
  }

  resultBox.innerText = "";
  loader.style.display = "block";

  try {
    if (mode === "fix") {
      const fixed = await fixHebrew(input);
      resultBox.innerText = fixed;
    }

    if (mode === "translate") {
      const translated = await translateRuHe(input);
      resultBox.innerText = translated;
    }

    if (mode === "voice") {
      resultBox.innerText = "–°–Ω–∞—á–∞–ª–∞ –Ω–∞–∂–º–∏—Ç–µ \"–ì–æ–ª–æ—Å\", –∑–∞—Ç–µ–º \"–û—Ç–ø—Ä–∞–≤–∏—Ç—å\"";
    }

  } catch (e) {
    resultBox.innerText = "–û—à–∏–±–∫–∞: —Å–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.";
  }

  loader.style.display = "none";
}


// ------------------------------
// 5. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
// ------------------------------
function copyResult() {
  const text = document.getElementById("result").innerText;
  navigator.clipboard.writeText(text);
  const alertBox = document.getElementById("copyAlert");
  alertBox.style.display = "block";
  setTimeout(() => alertBox.style.display = "none", 2000);
}
</script>

</body>
</html>
